<style>
    .button-17 {
    align-items: center;
    appearance: none;
    background-color: #fff;
    border-radius: 24px;
    border-style: none;
    box-shadow: rgba(0, 0, 0, .2) 0 3px 5px -1px,rgba(0, 0, 0, .14) 0 6px 10px 0,rgba(0, 0, 0, .12) 0 1px 18px 0;
    box-sizing: border-box;
    color: #3c4043;
    cursor: pointer;
    display: inline-flex;
    fill: currentcolor;
    font-family: "Google Sans",Roboto,Arial,sans-serif;
    font-size: 14px;
    font-weight: 500;
    height: 48px;
    justify-content: center;
    letter-spacing: .25px;
    line-height: normal;
    max-width: 100%;
    overflow: visible;
    padding: 2px 24px;
    position: relative;
    text-align: center;
    text-transform: none;
    transition: box-shadow 280ms cubic-bezier(.4, 0, .2, 1),opacity 15ms linear 30ms,transform 270ms cubic-bezier(0, 0, .2, 1) 0ms;
    user-select: none;
    -webkit-user-select: none;
    touch-action: manipulation;
    width: auto;
    will-change: transform,opacity;
    z-index: 0;
  }
  
  .button-17:hover {
    background: #F6F9FE;
    color: #174ea6;
  }
  
  .button-17:active {
    box-shadow: 0 4px 4px 0 rgb(60 64 67 / 30%), 0 8px 12px 6px rgb(60 64 67 / 15%);
    outline: none;
  }
  
  .button-17:focus {
    outline: none;
    border: 2px solid #4285f4;
  }
  
  .button-17:not(:disabled) {
    box-shadow: rgba(60, 64, 67, .3) 0 1px 3px 0, rgba(60, 64, 67, .15) 0 4px 8px 3px;
  }
  
  .button-17:not(:disabled):hover {
    box-shadow: rgba(60, 64, 67, .3) 0 2px 3px 0, rgba(60, 64, 67, .15) 0 6px 10px 4px;
  }
  
  .button-17:not(:disabled):focus {
    box-shadow: rgba(60, 64, 67, .3) 0 1px 3px 0, rgba(60, 64, 67, .15) 0 4px 8px 3px;
  }
  
  .button-17:not(:disabled):active {
    box-shadow: rgba(60, 64, 67, .3) 0 4px 4px 0, rgba(60, 64, 67, .15) 0 8px 12px 6px;
  }
  
  .button-17:disabled {
    box-shadow: rgba(60, 64, 67, .3) 0 1px 3px 0, rgba(60, 64, 67, .15) 0 4px 8px 3px;
  }
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<div class="container-fluid  pt-4 px-4" >
    <div class="row g-4">
        <div class="  col-xl-2 ">

        </div>
        <div class="col-sm-12 col-xs-12   col-xl-10">
            <div class="bg-light rounded h-100 p-4">
                <h6 class="mb-4">Categories</h6>
                <table id="cat" class="table table-hover">
                    <thead>
                       

                      
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">User</th>
                            <th scope="col">Address</th>
                            <th scope="col">Status</th>
                            <th scope="col">Total</th>
                            <th scope="col">Payment Method</th>
                            <th scope="col">Created</th>
                            <th scope="col">Product Detials</th>
                        </tr>

                       
                    </thead>
                    <tbody>
                     
                           
                        <% orders.forEach((el,i)=>{ %>
   
                                    <tr>
                                <th scope="row"><%= i+1 %></th>
                               
                                <td><%= el.user_Id.name %></td>
                                <td><%= result[i].name %>,<%= result[i].mob %>,<%= result[i].house%>,<%= result[i].landmark%>,<%=result[i].district%>,<%= result[i].state%>,<%= result[i].pincode %></td>
                                <td><%= el.orderStatus %></td>
                                <td>
                                    <%= el.cart.totalPrice %>
                                </td>
                                <% if(el.orderStatus=="cancelled" || el.orderStatus=="delivered"){%>
                                    <td></td>
                               <% }else{%>

                              
                                <td> <select style="border-radius: 10px;border-color: blue;background-color: aqua;" name="" onchange="status(this,'<%= el._id %>')" id="status">
                                    <option value="<%= el.orderStatus %>" selected><%= el.orderStatus %></option>
                                    <option value="confirmed">Confirmed</option>
                                    <option value="cancelled">Cancelled</option>
                                    <option value="delivered">Deliverd</option>
                                    <option value="shipped">Shipped</option>
                                    <option value="pending">Pending</option>
                                    <option value="placed">Placed</option>
                                   </select></td><% } %> 
                                <td><%= el.createdAt.toLocaleString() %></td>
                                <td>
                                    <button type="button" class="btn btn-primary" onclick="getPro('<%= el._id %>')" data-toggle="modal" data-target="#exampleModalLong">
                                        Products
                                      </button>
                                </td>
                                <!-- <td><button class="button-17" data-toggle="modal" data-target="#exampleMod" id="" onclick="getPro('<%= el._id %>')"  role="button">Products</button></td> -->
                            </tr>
                                
                            <% }) %> 
                            
                        
                    </tbody>
                </table>
            </div>
        </div>
        </div>
        <div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLongTitle">Products</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                 <div id="prodetials">

                 </div>
                 <div id="fetch">

                 </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
          <script>
           function getPro(id){
          console.log(id);
          $("#fetch").html('<i class="fa-solid fa-spinner fa-spin">Fetching data..')
          
           $.ajax({
            url:'/orderProducts',
            method:'post',
          
            data:{
             orderId:id
            },
            success:((response)=>{
              
              $('#prodetials').html('')
              response.cart.items.forEach((val,i)=>{
                $('#prodetials').append(`<table class="table table-hover table-dark">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">Title</th>
                <th scope="col">Price</th>
                <th scope="col">Quantity</th>
                <th scope="col">Size</th>
                <th scope="col">Description</th>
                <th scope="col">Images</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row">${i+1}</th>
                <td>${val.product_id.title}</td>
                <td>${val.product_id.price}</td>
                <td>${val.qty}</td>
                <td>${val.product_id.size}</td>
                <td>${val.product_id.description}</td>
                <td><img src=${val.product_id.image[0]} width='50px' height='auto'></td>
              </tr>
            </tbody>
          </table>`)
          
              })
              $('#fetch').html('')
            })
           })
           }
          
function status(e,od){
$.ajax({
    url:`/admin/changeStatus?s=${e.value}&id=${od}`,
    method:'get',
    success:((response)=>{
        if(response.status){
            Swal.fire({
  position: 'top-end',
  icon: 'success',
  title: 'Your work has been saved',
  showConfirmButton: false,
  timer: 1500
})
setTimeout(()=>location.reload(),3000)
        }
    })
})
}
        </script>
